<!DOCTYPE html>
<html>
<head>
    <title>South Park - GifTastic</title>
</head>
<body>
    
<div id = "buttons-list">
</div>

<form id="item-search">
    <label for="searchBar"></label>
    <input type="text" id="searchBar">

    <input type="submit" id="submit-button">
</form>

<div id= "spGifs">

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">
//  VARIABLES
//  --------------------------------------------
    
var spArray = ["Mr. Garrison", "Kyle Broflovski", "Stan Marsh", "Kenny McCormick", "Eric Cartman", "Mr. Slave", "Randy Marsh", "Butters Stotch", "Tweek Tweak", "Token Black", "Towelie", "Mr. Hankey", "Ike Broflovski", "Chef", "Canadians"];

// ********* Kirts Edits **********
// Create a function that formats the name expected by the Giphy API
// (dashes instead of spaces, no dots, and all lower case)
var formatName = function (charName) {
  // Remove dots (e.g. Mr.), replace spaces with dashes, then lowercase names
  return charName = charName.replace('.', '').replace(' ', '-').toLowerCase();
}

// The parent node in which I want to append the buttons
var buttonParent = $('#buttons-list');

var render = function () {
    // Loop through the character array, generate a button and append it to the parent
    for (let i = 0; i < spArray.length; i++) {
        var character = spArray[i];
        var myButton = '<button data-search="' + formatName(character) + '">' + character + '</button>';
        buttonParent.append(myButton);
    }
    attachLoadGifHandler();
}

// Function to submit the new button
$('#item-search').submit(function () {
    // Clear out all of the buttons
    buttonParent.empty();
    // Push the data entered into the form into our names array
    spArray.push($('#searchBar').val()); 
    // Re render the buttons
    render();
    return false;
})

//function to add gif to new button generated from submit bar
var attachLoadGifHandler = function () {
    // On click event to display 10 gifs relating to the word on the button
    $("button").on("click", function() {
        var x = $(this).data("search");
        console.log(x);

        var queryURL = "https://api.giphy.com/v1/gifs/search?&q=south%20park%20" + x + "&api_key=1bNGrlJ2oTvuncnETFmqLXNtUA7R8kr2&limit=10"; 
        console.log(queryURL);
    // Using ajax to access the GIPHY API
    // AJAX request     
        $.ajax({url:queryURL, method:'GET'})
            .done(function(response) {
            console.log(response);
            for (var i = 0; i < response.data.length; i++){
                $("#spGifs").prepend("<p>Rating: " + response.data[i].rating + "</p>");
                $("#spGifs").prepend("<img src= '" + response.data[i].images.fixed_width.url + "'>");
            }
            
        })

    })

}

// Now I will need to call it so that it renders when the page is first loaded
render();

    
   
</script>

</body>
</html>